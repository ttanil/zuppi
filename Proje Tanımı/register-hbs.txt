// GOOGLE SIGN-IN BUTTON CLICK (her zaman redirect)
    /*
    const googleBtn = document.getElementById('googleSignInBtn');

    googleBtn.addEventListener('click', function () {
      if (googleBtn.disabled) return;

      if (!(window.google && window.google.accounts && window.google.accounts.id)) {
        alert("Google kimlik servisleri henüz yüklenmedi. Lütfen birkaç saniye sonra tekrar deneyin.");
        return;
      }
      googleBtn.disabled = true;

      const clientId = '558871967639-4bh4ord5cphs9qhs8f8okrq9fvoh10v9.apps.googleusercontent.com';
      window.google.accounts.id.initialize({
        client_id: clientId,
        ux_mode: 'redirect',
        login_uri: window.location.origin + window.location.pathname
      });
      window.google.accounts.id.prompt();
    });

    window.addEventListener('DOMContentLoaded', () => {
      const googleBtn = document.getElementById('googleSignInBtn');
      if (googleBtn) googleBtn.disabled = false;
    });
    // JWT Decode helper
    function parseJwt(token) {
      let base64Url = token.split('.')[1];
      let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      let jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // Eksik bilgi gönderimi (modal submit)
    document.getElementById('extraInfoForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const feedback = document.getElementById('g_feedback');
      feedback.textContent = '';
      const formData = new FormData(this);
      const data = {};
      for (let [key, value] of formData.entries()) data[key] = value;

      if (!data.fullname || !data.birth_year || !data.city || !data.kurallar) {
        feedback.textContent = 'Lütfen tüm alanları doldurun ve onay kutusunu işaretleyin.';
        return;
      }

      const device_info = getDeviceInfo();
      const fpPromise = window.FingerprintJS.load();
      const fp = await fpPromise;
      const result = await fp.get();

      data.fingerprint = result.visitorId;
      data.device_info = device_info;
      data.google_signup = true;
      data.id_token = LAST_GOOGLE_ID_TOKEN || ''; // Google'dan dönen token

      const res = await fetch('/api/register', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      const json = await res.json();

      if (res.ok) {
        feedback.className = "text-success text-center mb-2";
        feedback.textContent = 'Google ile kayıt başarılı!';
        setTimeout(()=>window.location='/login', 1500);
      } else {
        feedback.className = "text-danger text-center mb-2";
        feedback.textContent = json.message || 'Google ile kayıt sırasında hata oluştu.';
      }
    });
    */